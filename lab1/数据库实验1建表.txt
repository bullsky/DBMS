

CREATE DATABASE COMPANY;

USE COMPANY;

drop DATABASE company;


CREATE TABLE EMPLOYEE (
	ENAME VARCHAR(32) not null, 
	ESSN VARCHAR(32) not null primary key, 
	ADDRESS VARCHAR(32) not null, 
	SALARY INT not null, 
	SUPERSSN VARCHAR(32) not null, 
	DNO VARCHAR(32) not null
);

CREATE TABLE DEPARTMENT (
	DNAME VARCHAR(32) not null, 
	DNO VARCHAR(32) not null primary key,
	MGRSSN VARCHAR(32) not null, 
	MGRSTARTDATE DATE not null
);

CREATE TABLE PROJECT (
	PNAME VARCHAR(32) not null, 
	PNO VARCHAR(32) not null primary key,
	PLOCATION VARCHAR(32) not null, 
	DNO VARCHAR(32) not null
);

CREATE TABLE WORKS_ON (
	ESSN VARCHAR(32) not null, 
	PNO VARCHAR(32) not null, 
	HOURS INT not null,
	primary key(ESSN ,PNO)
);

describe EMPLOYEE;
describe DEPARTMENT;
describe PROJECT;
describe WORKS_ON;

LOAD DATA LOCAL INFILE "E:/emp.txt" INTO TABLE EMPLOYEE;

LOAD DATA LOCAL INFILE "E:/depart.txt" INTO TABLE DEPARTMENT;

LOAD DATA LOCAL INFILE "E:/project.txt" INTO TABLE PROJECT;

LOAD DATA LOCAL INFILE "E:/work_on.txt" INTO TABLE WORKS_ON;

select * from EMPLOYEE;
select * from DEPARTMENT;
select * from PROJECT;
select * from WORKS_ON;

delete from EMPLOYEE;
delete from DEPARTMENT;
delete from PROJECT;
delete from WORKS_ON;


1
select ename 
from EMPLOYEE,PROJECT,WORKS_ON 
where (EMPLOYEE.ESSN = WORKS_ON.ESSN) AND (PROJECT.PNO = WORKS_ON.PNO) AND (PROJECT.PNAME = 'SQLProject');

2
select ename,address
from EMPLOYEE,DEPARTMENT 
where (EMPLOYEE.DNO = DEPARTMENT.DNO) AND (EMPLOYEE.SALARY < 3000) AND (DEPARTMENT.DNAME='ResearchDepartment');

3
SELECT ENAME FROM EMPLOYEE
where ename not in(
select ename from EMPLOYEE,WORKS_ON
where PNO ='P1' AND EMPLOYEE.ESSN=WORKS_ON.ESSN);

4
SELECT E1.ENAME,DNAME
FROM EMPLOYEE E1,EMPLOYEE E2,DEPARTMENT
WHERE E2.ENAME='张红' AND E1.DNO = DEPARTMENT.DNO AND E1.SUPERSSN = E2.ESSN;

5
SELECT EMPLOYEE.ESSN
FROM EMPLOYEE,WORKS_ON W1,WORKS_ON W2
WHERE EMPLOYEE.ESSN = W1.ESSN AND EMPLOYEE.ESSN=W2.ESSN AND W1.PNO='P1' AND W2.PNO='P2';

6
SELECT EMPLOYEE.ESSN,ENAME
FROM EMPLOYEE,WORKS_ON
WHERE EMPLOYEE.ESSN=WORKS_ON.ESSN
GROUP BY WORKS_ON.ESSN
HAVING COUNT(*) = (
	SELECT COUNT(*) 
	FROM PROJECT
	);


7 
SELECT DNAME
FROM  EMPLOYEE NATURAL join DEPARTMENT
GROUP BY DNO
HAVING AVG(SALARY) < 3000;

8
SELECT ENAME
FROM WORKS_ON NATURAL join EMPLOYEE
GROUP BY ESSN
HAVING COUNT(PNO)>=3 AND SUM(HOURS)<=8;

9

SELECT DNO,sum(SALARY)/sum(HOURS)
FROM EMPLOYEE NATURAL join  WORKS_ON
GROUP BY DNO;
